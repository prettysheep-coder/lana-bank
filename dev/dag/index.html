<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consolidated DAG Viewer</title>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
        }

        #controls {
            padding: 10px;
            background-color: #f0f0f0;
            border-bottom: 1px solid #ccc;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        #controls label,
        #controls button {
            margin-right: 5px;
        }

        #controls input {
            width: 60px;
            padding: 5px;
            margin-right: 5px;
        }

        #controls button {
            padding: 5px 10px;
            cursor: pointer;
        }

        #view-selector button.active {
            font-weight: bold;
            background-color: #ddd;
        }

        #graph-container {
            flex-grow: 1;
            width: 100%;
            height: 100%;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }

        svg {
            display: block;
            width: 100%;
            height: 100%;
        }

        .node rect {
            stroke: #333;
            fill: #fff;
            stroke-width: 1.5px;
        }

        .node.account rect {
            fill: #e8f0ff;
            stroke: #669cff;
        }

        /* Cala account */
        .node.account_set rect {
            fill: #fff8e1;
            stroke: #ffc107;
        }

        /* Cala set */
        /* Add specific styles for Lana nodes if needed, otherwise they use default */
        .edgePath path {
            stroke: #333;
            stroke-width: 1.5px;
            fill: none;
        }

        text {
            font-weight: 300;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serf;
            font-size: 14px;
        }

        .loading-message,
        .error-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2em;
            padding: 15px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 5px;
        }

        .error-message {
            color: red;
        }
    </style>
    <!-- Load D3, Dagre, and Dagre-D3 -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/dagre@0.8.5/dist/dagre.min.js"></script>
    <script src="https://unpkg.com/dagre-d3@0.6.4/dist/dagre-d3.min.js"></script>
</head>

<body>
    <div id="controls">
        <div id="view-selector">
            <span>View:</span>
            <button id="view-lana-button" class="active">Lana (Events)</button>
            <button id="view-cala-button">Cala (Accounts/Sets)</button>
        </div>
        <div id="depth-controls">
            <label for="depth-input">Max Depth:</label>
            <input type="number" id="depth-input" min="1">
            <button id="update-depth-button">Update Depth</button>
            <span>(Blank for All)</span>
        </div>
        <button id="save-svg-button">Save as SVG</button>
    </div>
    <div id="graph-container">
        <svg id="dag-canvas"></svg>
        <div id="loading-message" class="loading-message" style="display: none;">Loading graph data...</div>
        <div id="error-message" class="error-message" style="display: none;">Error loading data. Check console.</div>
    </div>

    <script src="graph.js"></script> <!-- Load the consolidated script -->
</body>

</html>